@(form: Form[_root_.orders.OrderForm], orderList: Seq[_root_.orders.Order], kafkaEvents: Seq[_root_.orders.OrderPlacedEvent])(implicit request: RequestHeader)

@main("Place Order") {
    <h1>Place Order</h1>

    <div class="concept-banner">
        <h3>Concepts: Play Forms, Slick ORM, Kafka Producer/Consumer</h3>
        <p>This page demonstrates order placement with database persistence and Kafka event publishing for checkout emails.</p>
    </div>

    @request.flash.get("success").map { message =>
        <div class="success">@message</div>
    }

    @helper.form(action = orders.routes.OrderController.placeOrder()) {
        @helper.CSRF.formField

        <div class="form-group">
            <label for="userName">Your Name</label>
            <input type="text" id="userName" name="userName" value="@form("userName").value.getOrElse("")" required>
            @form.error("userName").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <div class="form-group">
            <label for="itemName">Item</label>
            <input type="text" id="itemName" name="itemName" value="@form("itemName").value.getOrElse("")" required>
            @form.error("itemName").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <div class="form-group">
            <label for="quantity">Quantity</label>
            <input type="number" id="quantity" name="quantity" value="@form("quantity").value.getOrElse("1")" min="1" required>
            @form.error("quantity").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <button type="submit" class="btn-blue">Place Order</button>
    }

    <h2>Orders</h2>
    @if(orderList.isEmpty) {
        <p>No orders placed yet.</p>
    } else {
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Item</th>
                    <th>Qty</th>
                </tr>
            </thead>
            <tbody>
                @for(order <- orderList) {
                    <tr>
                        <td>@order.id</td>
                        <td>@order.userName</td>
                        <td>@order.itemName</td>
                        <td>@order.quantity</td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <h2>Checkout Emails (Kafka Events)</h2>
    @if(kafkaEvents.isEmpty) {
        <p>No checkout emails queued yet.</p>
    } else {
        <table>
            <thead>
                <tr>
                    <th>Event Type</th>
                    <th>Timestamp</th>
                    <th>Order ID</th>
                    <th>Name</th>
                    <th>Item</th>
                    <th>Qty</th>
                </tr>
            </thead>
            <tbody>
                @for(event <- kafkaEvents) {
                    <tr>
                        <td>@event.eventType</td>
                        <td>@event.timestamp</td>
                        <td>@event.order.id</td>
                        <td>@event.order.userName</td>
                        <td>@event.order.itemName</td>
                        <td>@event.order.quantity</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
