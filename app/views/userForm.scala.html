@(form: Form[_root_.users.UserForm], userList: Seq[_root_.users.User])(implicit request: RequestHeader)

@main("User Details") {
    <h1>User Details</h1>

    <div class="concept-banner">
        <h3>Concepts: Slick Table Mappings, Case Classes, Repository Pattern, Futures</h3>
        <p>User data is persisted via Slick ORM. A <code>case class User</code> maps directly to a database table through a <code>Table[User]</code> definition. All queries return <code>Future</code> and follow the repository pattern.</p>

        <details class="code-callout">
            <summary>Case Class + Slick Table Mapping <span class="callout-source">User.scala</span></summary>
            <pre><code>case class User(id: Long, name: String, email: String, phone: String)

class UsersTable(tag: Tag) extends Table[User](tag, "users"):
  def id    = column[Long]("id", O.PrimaryKey, O.AutoInc)
  def name  = column[String]("name")
  def email = column[String]("email")
  def phone = column[String]("phone")
  def *     = (id, name, email, phone).mapTo[User]</code></pre>
        </details>

        <details class="code-callout">
            <summary>Repository Pattern with Futures <span class="callout-source">UserRepository.scala</span></summary>
            <pre><code>class UserRepository @@Inject()(dbConfigProvider: DatabaseConfigProvider)(using ec: ExecutionContext):

  private val users = TableQuery[UsersTable]

  def list(): Future[Seq[User]] = db.run(users.result)

  def count(): Future[Int] = db.run(users.length.result)

  def create(name: String, email: String, phone: String): Future[User] =
    val insertQuery = (users.map(u =&gt; (u.name, u.email, u.phone))
      returning users.map(_.id)
      into ((fields, id) =&gt; User(id, fields._1, fields._2, fields._3)))
    db.run(insertQuery += (name, email, phone))</code></pre>
        </details>
    </div>

    @request.flash.get("success").map { message =>
        <div class="success">@message</div>
    }

    @helper.form(action = users.routes.UserController.saveUser()) {
        @helper.CSRF.formField

        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" value="@form("name").value.getOrElse("")" required>
            @form.error("name").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="@form("email").value.getOrElse("")" required>
            @form.error("email").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" name="phone" value="@form("phone").value.getOrElse("")" required>
            @form.error("phone").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <div class="btn-group">
            <button type="submit">Save User</button>
            <button type="button" class="btn-autofill" onclick="autoFillUser()">Auto Fill</button>
        </div>
    }

    <script>
    function autoFillUser() {
        var users = [
            { name: 'Alice Johnson', email: 'alice.johnson@@example.com', phone: '555-0101' },
            { name: 'Bob Martinez', email: 'bob.martinez@@shopmail.com', phone: '555-0202' },
            { name: 'Carol Chen', email: 'carol.chen@@techcorp.io', phone: '555-0303' },
            { name: 'David Kim', email: 'david.kim@@startup.dev', phone: '555-0404' },
            { name: 'Eva Rossi', email: 'eva.rossi@@designlab.co', phone: '555-0505' },
            { name: 'Frank Okafor', email: 'frank.okafor@@globalshop.com', phone: '555-0606' }
        ];
        var u = users[Math.floor(Math.random() * users.length)];
        document.getElementById('name').value = u.name;
        document.getElementById('email').value = u.email;
        document.getElementById('phone').value = u.phone;
    }
    </script>

    <h2>Saved Users</h2>
    @if(userList.isEmpty) {
        <p>No users saved yet.</p>
    } else {
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                </tr>
            </thead>
            <tbody>
                @for(user <- userList) {
                    <tr>
                        <td>@user.id</td>
                        <td>@user.name</td>
                        <td>@user.email</td>
                        <td>@user.phone</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
