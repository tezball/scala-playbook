@(form: Form[_root_.users.UserForm], userList: Seq[_root_.users.User], kafkaEvents: Seq[_root_.users.UserCreatedEvent])(implicit request: RequestHeader)

@main("User Details") {
    <h1>User Details</h1>

    <div class="concept-banner">
        <h3>Concepts: Play Forms, Slick ORM, Kafka Producer/Consumer</h3>
        <p>This page demonstrates the Play Framework form binding, Slick database operations, and Kafka event-driven messaging.</p>
    </div>

    @request.flash.get("success").map { message =>
        <div class="success">@message</div>
    }

    @helper.form(action = users.routes.UserController.saveUser()) {
        @helper.CSRF.formField

        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" value="@form("name").value.getOrElse("")" required>
            @form.error("name").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="@form("email").value.getOrElse("")" required>
            @form.error("email").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" name="phone" value="@form("phone").value.getOrElse("")" required>
            @form.error("phone").map { error =>
                <div class="error-msg">@error.message</div>
            }
        </div>

        <button type="submit">Save User</button>
    }

    <h2>Saved Users</h2>
    @if(userList.isEmpty) {
        <p>No users saved yet.</p>
    } else {
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                </tr>
            </thead>
            <tbody>
                @for(user <- userList) {
                    <tr>
                        <td>@user.id</td>
                        <td>@user.name</td>
                        <td>@user.email</td>
                        <td>@user.phone</td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <h2>Kafka Events</h2>
    @if(kafkaEvents.isEmpty) {
        <p>No events consumed yet.</p>
    } else {
        <table>
            <thead>
                <tr>
                    <th>Event Type</th>
                    <th>Timestamp</th>
                    <th>User ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                </tr>
            </thead>
            <tbody>
                @for(event <- kafkaEvents) {
                    <tr>
                        <td>@event.eventType</td>
                        <td>@event.timestamp</td>
                        <td>@event.user.id</td>
                        <td>@event.user.name</td>
                        <td>@event.user.email</td>
                        <td>@event.user.phone</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
